version: '3.9'

x-dev-service: &dev-service
  volumes:
    - ./services/${SERVICE_NAME}/src:/app/src
    - ./services/${SERVICE_NAME}/node_modules:/app/node_modules
  command: npm run dev
  environment:
    - NODE_ENV=development
    - TS_NODE_DEV=true

services:
  game-logic:
    <<: *dev-service
    environment:
      - SERVICE_NAME=game-logic-service
      - PORT=5001

  ai-service:
    <<: *dev-service
    environment:
      - SERVICE_NAME=ai-service
      - PORT=5002

  data-integration:
    <<: *dev-service
    environment:
      - SERVICE_NAME=data-integration
      - PORT=5003

  economy:
    <<: *dev-service
    environment:
      - SERVICE_NAME=economy-management
      - PORT=5004

  leaderboard:
    <<: *dev-service
    environment:
      - SERVICE_NAME=leaderboard-service
      - PORT=5005

  matchmaking:
    <<: *dev-service
    environment:
      - SERVICE_NAME=matchmaking-service
      - PORT=5006

  notifications:
    <<: *dev-service
    environment:
      - SERVICE_NAME=notification-service
      - PORT=5007

  persistence:
    <<: *dev-service
    environment:
      - SERVICE_NAME=persistence-service
      - PORT=5008

  rewards:
    <<: *dev-service
    environment:
      - SERVICE_NAME=rewards-service
      - PORT=5009

  social:
    <<: *dev-service
    environment:
      - SERVICE_NAME=social-service
      - PORT=5010

  tutorial:
    <<: *dev-service
    environment:
      - SERVICE_NAME=tutorial-service
      - PORT=5011

  user:
    <<: *dev-service
    environment:
      - SERVICE_NAME=user-service
      - PORT=5012

  # Development-specific overrides for MongoDB
  mongodb:
    ports:
      - "27017:27017"
    volumes:
      - mongodb_dev_data:/data/db
      - ./config/mongodb:/docker-entrypoint-initdb.d
    environment:
      - MONGODB_DATABASE=srt8192_dev

  # Development-specific overrides for Redis
  redis:
    ports:
      - "6379:6379"
    volumes:
      - redis_dev_data:/data
    command: ["redis-server", "--appendonly", "yes", "--save", "60", "1"]

volumes:
  mongodb_dev_data:
  redis_dev_data: